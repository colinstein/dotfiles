# Paths
set folder = ~/.mail
set alias_file = ~/.mutt/alias
set header_cache = ~/.mutt/cache/headers
set message_cachedir = ~/.mutt/cache/bodies
set certificate_file = ~/.mutt/certificates
set mailcap_path = ~/.mutt/mailcap
set tmpdir = ~/.mutt/tmp

# S/MIME
set smime_is_default = yes
set smime_ca_location = /usr/local/etc/openssl/cert.pem
set smime_keys = ~/.mutt/smime/keys
set smime_certificates = ~/.mutt/smime/certificates
set smime_timeout = 300
set smime_default_key = "6d2d507a.0"

set crypt_autosign = yes
set crypt_replyencrypt = yes
set crypt_replysignencrypted = yes
set crypt_verify_sig = yes

set smime_pk7out_command          = "openssl mime -verify -in %f -noverify -pk7out"
set smime_get_cert_command        = "openssl pkcs7 -print_certs -in %f"
set smime_get_signer_cert_command = "openssl smime -verify -in %f -noverify -signer %c -out /dev/null"
set smime_get_cert_email_command  = "openssl x509 -in %f -noout -email"
set smime_import_cert_command     = "smime_keys add_cert %f"

set smime_encrypt_command         = "openssl smime -encrypt -%a -outform DEF -in %f %c"
set smime_sign_command            = "openssl smime -sign -signer %c -inkey %k -passin pass:$(/Users/cstein/.mutt/bin/smime_password.sh) -in %f -certfile %i -outform DER"
set smime_decrypt_command         = "openssl smime -decrypt -passin pass:$(/Users/cstein/.mutt/bin/smime_password.sh) -inform DER -in %f -inkey %k -recip %c"

set smime_verify_command          = "openssl smime -verify -inform DER -in %s %C -content %f"
set smime_verify_opaque_command   ="\
openssl smime -verify -inform DER -in %s %C || \
openssl smime -verify -inform DER -in %s -noverify 2>/dev/null"

# Basic options
set wait_key = no
set mbox_type = Maildir
set timeout = 3
set mail_check = 0
unset move
set delete
unset confirmappend
set quit
unset mark_old
unset beep_new
set pipe_decode
set thorough_search
set print_command = "~/.mutt/bin/print_message.sh"

# Colours
source ~/.mutt/themes/mutt-solarized-dark.muttrc

# Sidebar
set sidebar_visible = no
set sidebar_delim = ' | '
set sidebar_width = 30
color sidebar_new yellow default
set sidebar_shortpath = yes

# Sidebar Folders
mailboxes  +icloud/Inbox\
           +icloud/Banking\
           +icloud/Housing\
           +icloud/Receipts\
           +icloud/West\ Work\
           +icloud/Archive\
           +icloud/Deleted\ Messages\
           +icloud/Junk\
           +icloud/Sent\ Messages\
           +icloud/Queue\
           +icloud/Drafts\

# Statusbar
set status_chars = " *%A"
set status_format = "Folder: %f : %r%n new (%m messages)%?%d? (%d to delete)?%?t? (%t tagged)? %>-%?p? ( %p postponed )? : "
set status_on_top = yes

# Headers
ignore *
unignore subject: from: date: to: cc:
unhdr_order *
hdr_order subject: from: date: to: cc:

# Index
set date_format = "%a %b %d - %H:%m"
set index_format = "[%Z]    %D    %-20.20F    %s"
set sort = threads
set sort_aux = reverse-last-date-received
set uncollapse_jump
set sort_re
set reply_regexp = "^(([Rr][Ee]?(\\[0-9]+])?: *)?(\[[^]]+\] *)?)*"

# Pager
set pager_index_lines = 10
set pager_context = 3
set pager_stop
set pager_format = " "
set menu_scroll
set tilde
unset markers
set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[aaa-z0-9]+[>|]+)+"
alternative_order text/html text/plain text/enriched
auto_view text/html

# Compose
set copy = yes
set use_envelope_from = yes
set sig_dashes = yes
set edit_headers = yes
set fast_reply = yes
set fcc_attach = yes
set mime_forward = ask-no
set forward_format = "Fwd: %s"
set forward_decode = yes
set attribution = "On %d, %n wrote:"
set include = yes
set forward_quote = yes
set editor = "vim"
set text_flowed = yes
set query_command = "contacts -Sf '%eTOKEN%n' '%s' | sed -e 's/TOKEN/\t/g'"

# Key Binding
macro index,pager B "bounce-message"
bind index,pager \Ck sidebar-prev
bind index,pager \Cj sidebar-next
bind index,pager \Cl sidebar-open
bind index,pager A "create-alias"
macro index,pager \cv '|urlview<enter>' 'use url_view'
macro index \Cb '<enter-command>toggle sidebar_visible<enter><refresh>'
macro pager \Cb '<enter-command>toggle sidebar_visible<enter><redraw-screen>'
macro index C '<copy-message>?<toggle-mailboxes>' 'copy a message to a mailbox'
macro index M '<save-message>?<toggle-mailboxes>' 'move a message to a mailbox'
macro index,pager a '<save-message>=icloud/Archive<enter><enter>' 'Archive message'
macro index,pager z '<save-message>=icloud/Queue<enter><enter>' 'Archive message'
bind editor <TAB> complete-query
bind editor \CT complete
bind index,pager q noop
bind index,pager x noop
bind index gg first-entry
bind index G last-entry
bind index R group-reply
bind index \CR recall-message
bind index,pager ZZ quit
bind index,pager q exit

# Fancy filtering of Message content
set display_filter = "~/.mutt/bin/display_filter.sh"

# Accounts
#folder-hook icloud/* source ~/.mutt/accounts/icloud
source ~/.mutt/accounts/icloud
